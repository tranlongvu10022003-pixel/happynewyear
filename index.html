<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>üéÜ Happy New Year üéÜ</title>
<style>
html,body{
    margin:0;
    padding:0;
    overflow:hidden;
    background:black;
    font-family:Arial,sans-serif;
    color:white;
}
#ui{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    text-align:center;
    z-index:10;
}
h1{
    font-size:50px;
    text-shadow:0 0 15px gold;
}
#countdown{
    font-size:28px;
    margin-top:10px;
}
input{
    padding:8px;
    border-radius:8px;
    border:none;
    font-size:16px;
}
button{
    margin-top:10px;
    padding:8px 18px;
    border:none;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
}
.glow{
    animation:glow 1s infinite alternate;
}
@keyframes glow{
    from{ text-shadow:0 0 10px red;}
    to{ text-shadow:0 0 25px gold;}
}
canvas{
    position:fixed;
    top:0;left:0;
}
</style>
</head>
<body>

<canvas id="cv"></canvas>

<div id="ui">
    <h1 id="title">üéÜ ƒê·∫øm Ng∆∞·ª£c NƒÉm M·ªõi üéÜ</h1>
    <div id="countdown">ƒêang ƒë·ªìng b·ªô th·ªùi gian...</div><br>
    <input id="name" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi nh·∫≠n">
    <br>
    <button onclick="startMusic()">üîä B·∫≠t nh·∫°c</button>
</div>

<!-- üéµ Nh·∫°c -->
<audio id="countMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3">
  </audio>
  
  <audio id="tetMusic">
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3">
  </audio>
  

  <script type="module">
    /* ================= TIME (Internet + fallback) ================= */
    let offset = 0;
    
    async function syncTime(){
      try{
        const r = await fetch("https://worldtimeapi.org/api/timezone/Asia/Ho_Chi_Minh");
        const d = await r.json();
        offset = new Date(d.datetime).getTime() - Date.now();
      }catch(e){
        console.warn("Kh√¥ng l·∫•y ƒë∆∞·ª£c gi·ªù Internet, d√πng gi·ªù m√°y");
        offset = 0;
      }
    }
    function now(){
      return new Date(Date.now() + offset);
    }
    
    /* ================= DOM ================= */
    const title = document.getElementById("title");
    const cd = document.getElementById("countdown");
    const nameInput = document.getElementById("name");
    
    const countMusic = document.getElementById("countMusic");
    const tetMusic   = document.getElementById("tetMusic");
    
    /* B·∫ÆT BU·ªòC: h√†m global cho n√∫t */
    window.startMusic = () => {
      countMusic.play().catch(()=>{});
    };
    
    /* ================= COUNTDOWN ================= */
    let started = false;
    let fireworks = false;
    
    function tick(){
      const t = now();
      const target = new Date(`January 1, ${t.getFullYear()+1} 00:00:00`);
      const diff = target - t;
    
      if(diff <= 0){
        const name = nameInput.value || "b·∫°n";
        title.innerHTML = `üéä HAPPY NEW YEAR ${name.toUpperCase()} üéä`;
        title.classList.add("glow");
        cd.innerHTML = "Ch√∫c nƒÉm m·ªõi An Khang ‚Äì Th·ªãnh V∆∞·ª£ng üéâ";
    
        countMusic.pause();
        tetMusic.play().catch(()=>{});
    
        fireworks = true;
        clearInterval(timer);
        return;
      }
    showFireworks();
      const d = Math.floor(diff / 86400000);
      const h = Math.floor(diff / 3600000) % 24;
      const m = Math.floor(diff / 60000) % 60;
      const s = Math.floor(diff / 1000) % 60;
    
      cd.innerHTML = `‚è≥ ${d} ng√†y ${h} gi·ªù ${m} ph√∫t ${s} gi√¢y`;
    
      /* KH√îNG autoplay ‚Äì ch·ªâ play sau khi b·∫•m n√∫t */
      if(started && countMusic.paused){
        countMusic.play().catch(()=>{});
      }
    }
    
    /* ================= FIREWORKS ================= */
    const canvas = document.getElementById("cv");
    const ctx = canvas.getContext("2d");
    canvas.width = innerWidth;
    canvas.height = innerHeight;
    
    let particles = [];
    
    function spawn(){
      for(let i=0;i<80;i++){
        particles.push({
          x: Math.random()*canvas.width,
          y: Math.random()*canvas.height/2,
          vx:(Math.random()-0.5)*6,
          vy:(Math.random()-0.5)*6,
          life:100,
          col:`hsl(${Math.random()*360},100%,50%)`
        });
      }
    }
    
    function draw(){
      ctx.fillStyle = "rgba(0,0,0,0.25)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
    
      particles.forEach(p=>{
        ctx.fillStyle = p.col;
        ctx.fillRect(p.x,p.y,3,3);
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.04;
        p.life--;
      });
    
      particles = particles.filter(p=>p.life>0);
    
      if(fireworks && Math.random()<0.06) spawn();
      requestAnimationFrame(draw);
    }
    draw();
    
    /* ================= START ================= */
    await syncTime();
    const timer = setInterval(tick,1000);
    </script>
    <canvas id="fireworks"></canvas>

<script>
const canvas = document.getElementById("fireworks");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

canvas.style.position = "fixed";
canvas.style.top = 0;
canvas.style.left = 0;
canvas.style.pointerEvents = "none";
canvas.style.zIndex = 999;

window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

function random(min, max) {
  return Math.random() * (max - min) + min;
}

function showFireworks() {
  for (let i = 0; i < 80; i++) {
    setTimeout(() => {
      const x = random(0, canvas.width);
      const y = random(0, canvas.height / 2);
      for (let j = 0; j < 50; j++) {
        drawParticle(x, y);
      }
    }, i * 100);
  }
}

function drawParticle(x, y) {
  const angle = Math.random() * Math.PI * 2;
  const speed = random(2, 6);
  const vx = Math.cos(angle) * speed;
  const vy = Math.sin(angle) * speed;
  let alpha = 1;
  const color = `hsl(${Math.random() * 360}, 100%, 60%)`;

  const interval = setInterval(() => {
    ctx.fillStyle = color;
    ctx.globalAlpha = alpha;
    ctx.beginPath();
    ctx.arc(x, y, 2, 0, Math.PI * 2);
    ctx.fill();

    x += vx;
    y += vy;
    alpha -= 0.02;

    if (alpha <= 0) {
      clearInterval(interval);
    }
  }, 16);
}
</script>

    
    
</body>
</html>

